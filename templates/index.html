<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mindloom</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">
  <div class="max-w-xl mx-auto space-y-4">
    <h1 class="text-2xl font-bold mb-4">Mindloom Interface</h1>
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">Parse Projects</h2>
      <div class="flex gap-2">
        <button id="parseBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Parse</button>
        <button id="tasksBtn" class="px-3 py-1 bg-green-500 text-white rounded">Save Tasks</button>
      </div>
      <pre id="parseResult" class="bg-gray-100 p-2 rounded"></pre>
      <pre id="tasksResult" class="bg-gray-100 p-2 rounded"></pre>
    </section>
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">Record Energy</h2>
      <div class="flex gap-2">
        <select id="energy" class="border p-1 flex-1">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <select id="mood" class="border p-1 flex-1">
          <option value="Focused">ğŸ¯ Focused</option>
          <option value="Tired">ğŸ˜´ Tired</option>
          <option value="Flat">ğŸ˜ Flat</option>
          <option value="Anxious">ğŸ˜° Anxious</option>
          <option value="Upbeat">ğŸ˜ƒ Upbeat</option>
        </select>
        <button id="recordBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Record</button>
      </div>
      <pre id="recordResult" class="bg-gray-100 p-2 rounded"></pre>
    </section>
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">Data</h2>
      <div class="flex gap-2">
        <button id="loadProjects" class="px-3 py-1 bg-blue-500 text-white rounded">Load Projects</button>
        <button id="loadEnergy" class="px-3 py-1 bg-blue-500 text-white rounded">Load Energy</button>
      </div>
      <pre id="projects" class="bg-gray-100 p-2 rounded"></pre>
      <pre id="energyData" class="bg-gray-100 p-2 rounded"></pre>
    </section>
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">Prompts</h2>
      <div class="flex gap-2">
        <select id="promptSelect" class="border p-1 flex-1">
          {% for p in prompt_files %}
          <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>
        <textarea id="promptVars" placeholder="{\"energy\":5}" class="border p-1 flex-1"></textarea>
        <button id="renderPrompt" class="px-3 py-1 bg-blue-500 text-white rounded">Render</button>
      </div>
      <pre id="promptResult" class="bg-gray-100 p-2 rounded"></pre>
    </section>
  </div>

<script>
const parseBtn = document.getElementById('parseBtn');
parseBtn.onclick = async () => {
  const res = await fetch('/parse-projects', {method: 'POST'});
  const data = await res.json();
  document.getElementById('parseResult').textContent = JSON.stringify(data);
};

const tasksBtn = document.getElementById('tasksBtn');
tasksBtn.onclick = async () => {
  const res = await fetch('/save-tasks', {method: 'POST'});
  const data = await res.json();
  document.getElementById('tasksResult').textContent = JSON.stringify(data);
};

const recordBtn = document.getElementById('recordBtn');
recordBtn.onclick = async () => {
  const payload = {
    energy: parseInt(document.getElementById('energy').value),
    mood: document.getElementById('mood').value
  };
  const res = await fetch('/energy', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById('recordResult').textContent = JSON.stringify(data);
};

document.getElementById('loadProjects').onclick = async () => {
  const res = await fetch('/projects');
  const data = await res.json();
  document.getElementById('projects').textContent = JSON.stringify(data, null, 2);
};

document.getElementById('loadEnergy').onclick = async () => {
  const res = await fetch('/energy');
  const data = await res.json();
  document.getElementById('energyData').textContent = JSON.stringify(data, null, 2);
};

document.getElementById('renderPrompt').onclick = async () => {
  const select = document.getElementById('promptSelect');
  const varsText = document.getElementById('promptVars').value || '{}';
  let variables = {};
  try {
    variables = JSON.parse(varsText);
  } catch {
    alert('Invalid JSON in variables');
    return;
  }
  try {
    const tasksRes = await fetch('/tasks');
    if (tasksRes.ok) {
      variables.tasks = await tasksRes.json();
    }
  } catch (e) {
    console.error('Failed to load tasks', e);
  }
  const payload = { template: select.value, variables };
  const res = await fetch('/render-prompt', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById('promptResult').textContent = data.result;
};
</script>
</body>
</html>
